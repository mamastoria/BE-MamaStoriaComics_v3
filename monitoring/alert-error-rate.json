{
    "displayName": "Cloud Run - High Error Rate Alert",
    "combiner": "OR",
    "conditions": [
        {
            "displayName": "Error Rate > 5%",
            "conditionThreshold": {
                "filter": "resource.type = \"cloud_run_revision\" AND metric.type = \"run.googleapis.com/request_count\" AND metric.labels.response_code_class != \"2xx\"",
                "aggregations": [
                    {
                        "alignmentPeriod": "300s",
                        "perSeriesAligner": "ALIGN_RATE",
                        "crossSeriesReducer": "REDUCE_SUM",
                        "groupByFields": [
                            "resource.labels.service_name"
                        ]
                    }
                ],
                "comparison": "COMPARISON_GT",
                "thresholdValue": 0.05,
                "duration": "300s",
                "trigger": {
                    "count": 1
                }
            }
        }
    ],
    "alertStrategy": {
        "autoClose": "604800s"
    },
    "documentation": {
        "content": "## High Error Rate Detected\n\nThe Cloud Run service is experiencing more than 5% error rate.\n\n### Actions:\n1. Check Cloud Logging for error details\n2. Check recent deployments\n3. Verify database connectivity\n4. Check Vertex AI quota\n\n### Links:\n- [Cloud Run Console](https://console.cloud.google.com/run?project=nanobananacomic-482111)\n- [Logs](https://console.cloud.google.com/logs?project=nanobananacomic-482111)",
        "mimeType": "text/markdown"
    },
    "severity": "ERROR"
}